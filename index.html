<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SEP FOOD ลูกชิ้นทอด55</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        header {
            background-color: #c92d22;
            color: white;
            text-align: center;
            padding: 15px 0;
        }
        .main-layout {
            display: flex;
            gap: 20px;
            max-width: 1200px;
            margin: 30px auto;
        }
        .queue-container {
            width: 280px;
            max-height: 85vh;
            overflow-y: auto;
            background: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 15px rgba(0,0,0,0.3);
            flex-shrink: 0;
            position: sticky;
            top: 20px;
        }
        .queue-container h3 {
            margin: 0 0 10px 0;
            font-size: 18px;
            text-align: center;
            color: #c92d22;
        }
        .queue-item {
            border-bottom: 1px solid #ddd;
            padding: 8px 0;
            font-size: 14px;
        }
        .queue-item:last-child {
            border-bottom: none;
        }
        .container {
            flex: 1;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 20px rgba(0, 0, 0, 0.2);
        }
        .tabs {
            display: flex;
            justify-content: left;
            margin-bottom: 20px;
            border-bottom: 2px solid #f44336;
            padding-bottom: 10px;
        }
        .tablink {
            background-color: #fff;
            color: #555;
            border: none;
            padding: 12px 25px;
            cursor: pointer;
            border-radius: 10px 10px 0 0;
            transition: background-color 0.3s, color 0.3s;
            margin-right: 10px;
        }
        .tablink:hover {
            background-color: #ddd;
        }
        .tablink.active {
            background-color: #f44336;
            color: white;
        }
        .menu {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }
        .item {
            background-color: #fff;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        .item:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
        }
        .order-list {
            margin-top: 20px;
            border-top: 2px solid #f44336;
            padding-top: 20px;
        }
        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            border-bottom: 1px solid #ccc;
        }
        .total {
            text-align: right;
            font-weight: bold;
            margin-top: 10px;
            font-size: 20px;
            color: #333;
        }
        .payment-button {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .payment-button:hover {
            background-color: #c62828;
        }
        .notification {
            display: none;
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #f44336;
            color: white;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
            z-index: 999;
        }
        @media (max-width: 900px) {
            .main-layout { flex-direction: column; }
            .queue-container { width: 100%; max-height: none; position: relative; }
        }

                .checkout {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid #f44336;
        }
        .payment-button {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .payment-button:hover {
            background-color: #c62828;
        }
        .cancel-button {
            background-color: #9e9e9e;
            color: #333;
            border: none;
            border-radius: 5px;
            padding: 12px 20px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .cancel-button:hover {
            background-color: #757575;
        }
        .add-remove-button {
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .add-remove-button:hover {
            background-color: #45a049;
        }
        .remove-button {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 8px 15px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        .remove-button:hover {
            background-color: #c62828;
        }
    </style>
</head>
<body>
<header>
    <img src="images/lukchin.jpg" alt="alternatetext" style="width:250px;height:50px;">
</header>

<div class="main-layout">
    <!-- คิวออเดอร์ -->
    <div class="queue-container">
        <h3>คิวออเดอร์</h3>
        <div id="queue-list"></div>
    </div>

    <!-- เมนู + ออร์เดอร์ -->
    <div class="container">
        <div class="tabs">
            <button class="tablink active" onclick="openTab(event, 'food-menu')">เมนูอาหาร</button>
            <button class="tablink" onclick="openTab(event, 'drink-menu')">เมนูน้ำ</button>
            <input type="text" id="search" placeholder="ค้นหาสินค้า" onkeyup="searchMenu()">
        </div>
        <!-- เมนูอาหาร -->
        <div id="food-menu" class="menu">
            <div class="item" data-price="10"><div>ไส้กรอกชีส 10 บาท</div></div>
            <div class="item" data-price="10"><div>ลูกชิ้นเนื้อ 10 บาท</div></div>
            <div class="item" data-price="5"><div>ลูกชิ้นปลา 5 บาท</div></div>
            <div class="item" data-price="5"><div>ลูกชิ้นกุ้ง 5 บาท</div></div>
            <div class="item" data-price="5"><div>ไส้กรอก 5 บาท</div></div>
            <div class="item" data-price="5"><div>ไส้กรอกแดง 5 บาท</div></div>
            <div class="item" data-price="5"><div>ไส้กรอกนม 5 บาท</div></div>
        </div>
        <!-- เมนูน้ำ -->
        <div id="drink-menu" class="menu" style="display:none;">
            <div class="item" data-price="10"><div>น้ำเขียว 10 บาท</div></div>
            <div class="item" data-price="10"><div>น้ำแป็บซี่ 10 บาท</div></div>
            <div class="item" data-price="10"><div>น้ำแดง 10 บาท</div></div>
            <div class="item" data-price="10"><div>น้ำองุ่น 10 บาท</div></div>
        </div>
        <!-- รายการสั่งซื้อ -->
        <div class="order-list" id="order-list">
            <h2>รายการสั่งอาหาร</h2>
            <div class="total" id="item-count">จำนวนรายการ: 0</div>
            <ul id="order-items"></ul>
            <div class="total" id="total">ยอดรวม: 0 บาท</div>
            <button class="payment-button" id="cash-button">ชำระเงินสด</button>
            <button class="payment-button" id="transfer-button">Qr Code</button>
        </div>
    </div>
</div>

<div class="notification" id="notification">เพิ่มสินค้าแล้ว!</div>

<script>
    const orderList = [];
    const orderItems = document.getElementById('order-items');
    const totalElement = document.getElementById('total');
    const cashButton = document.getElementById('cash-button');
    const transferButton = document.getElementById('transfer-button');
    const notification = document.getElementById('notification');

    // เลือกสินค้า
    document.querySelectorAll('.item').forEach(item => {
        item.addEventListener('click', () => {
            const itemName = item.innerText;
            const itemPrice = parseFloat(item.getAttribute('data-price'));
            const existingItem = orderList.find(i => i.name === itemName);
            
            if (existingItem) {
                existingItem.quantity++;
                existingItem.totalPrice += itemPrice;
            } else {
                orderList.push({ name: itemName, price: itemPrice, quantity: 1, totalPrice: itemPrice });
            }

            updateOrderList();
            showNotification();
        });
    });

    function showNotification() {
        notification.style.display = 'block';
        setTimeout(() => { notification.style.display = 'none'; }, 2000);
    }

    function updateOrderList() {
        orderItems.innerHTML = '';
        let totalCount = 0;
        orderList.forEach((item, index) => {
            const orderItem = document.createElement('li');
            orderItem.className = 'order-item';
            orderItem.innerHTML = `
                <span>${item.name}</span>
                <span>${item.price} บาท x ${item.quantity}</span>
                <button class="add-remove-button" data-index="${index}" data-action="increase">เพิ่ม</button>
                <button class="add-remove-button" data-index="${index}" data-action="decrease">ลด</button>
                <button class="remove-button" data-index="${index}">ลบ</button>
            `;
            orderItems.appendChild(orderItem);
            totalCount += item.quantity;
        });

        totalElement.textContent = `ยอดรวม: ${calculateTotalPrice()} บาท`;
        document.getElementById('item-count').textContent = `จำนวนรายการ: ${totalCount}`;

        // ปุ่มเพิ่มลด
        document.querySelectorAll('.add-remove-button[data-index]').forEach(button => {
            button.addEventListener('click', () => {
                const index = parseInt(button.getAttribute('data-index'));
                const action = button.getAttribute('data-action');
                if (action === "increase") {
                    orderList[index].quantity++;
                } else {
                    if (orderList[index].quantity > 1) {
                        orderList[index].quantity--;
                    } else {
                        orderList.splice(index, 1);
                    }
                }
                orderList[index] && (orderList[index].totalPrice = orderList[index].quantity * orderList[index].price);
                updateOrderList();
            });
        });

        // ปุ่มลบ
        document.querySelectorAll('.remove-button').forEach(button => {
            button.addEventListener('click', () => {
                const index = parseInt(button.getAttribute('data-index'));
                orderList.splice(index, 1);
                updateOrderList();
            });
        });
    }

    function calculateTotalPrice() {
        return orderList.reduce((total, item) => total + item.totalPrice, 0);
    }

    // ฟังก์ชันบันทึกออเดอร์และเพิ่มเลขคิว
    function saveOrderForStaff() {
        const orderId = `ORD-${Date.now()}`;
        const orderData = {
            id: orderId,
            items: [...orderList],
            total: calculateTotalPrice(),
            status: "pending",
            time: new Date().toLocaleString()
        };

        const existingOrders = JSON.parse(localStorage.getItem('orders') || '[]');
        existingOrders.push(orderData);
        localStorage.setItem('orders', JSON.stringify(existingOrders));
        loadQueue();  
    }

    cashButton.addEventListener('click', () => {
        const totalPrice = calculateTotalPrice();
        if (confirm(`คุณต้องการชำระเงิน ${totalPrice} บาท ด้วยเงินสดหรือไม่?`)) {
            saveOrderForStaff();
            alert('ชำระเงินเรียบร้อย');
            orderList.length = 0;
            updateOrderList();
        }
    });

    transferButton.addEventListener('click', () => {
        const totalPrice = calculateTotalPrice();
        if (confirm(`คุณต้องการชำระเงิน ${totalPrice} บาท ด้วย Qr Code หรือไม่?`)) {
            saveOrderForStaff();
            alert('ชำระเงินเรียบร้อย (โอน QR)');
            orderList.length = 0;
            updateOrderList();
        }
    });

    function openTab(evt, tabName) {
        const tabs = document.querySelectorAll('.menu');
        tabs.forEach(tab => tab.style.display = "none");
        document.getElementById(tabName).style.display = "grid";

        const tablinks = document.querySelectorAll('.tablink');
        tablinks.forEach(tablink => tablink.className = tablink.className.replace(" active", ""));
        evt.currentTarget.className += " active";
    }

    function searchMenu() {
        const input = document.getElementById('search').value.toLowerCase();
        const items = document.querySelectorAll('.item');
        items.forEach(item => {
            const text = item.innerText.toLowerCase();
            item.style.display = text.includes(input) ? "block" : "none";
        });
    }

    // โหลดคิวมาโชว์
    function loadQueue() {
        const queueList = document.getElementById('queue-list');
        const orders = JSON.parse(localStorage.getItem('orders') || '[]');
        queueList.innerHTML = '';
        if (orders.length === 0) {
            queueList.innerHTML = '<p style="text-align:center; color:#666;">ยังไม่มีคิว</p>';
        } else {
            orders.forEach((order, i) => {
                const div = document.createElement('div');
                div.className = 'queue-item';
                div.innerHTML = `
                    <strong>#${i+1}</strong> ${order.time}<br>
                    <span style="color:#333;">${order.items.map(it=> it.name + 'x' + it.quantity).join(', ')}</span><br>
                    <em>รวม ${order.total} บาท</em>
                `;
                queueList.appendChild(div);
            });
        }
    }

    // โหลดคิวตอนเปิด + รีเฟรชทุก 3 วิ
    window.onload = () => {
        loadQueue();
        setInterval(loadQueue, 1000);
    };

// โหลดคิวมาโชว์
function loadQueue() {
    const queueList = document.getElementById('queue-list');
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    queueList.innerHTML = '';
    if (orders.length === 0) {
        queueList.innerHTML = '<p style="text-align:center; color:#666;">ยังไม่มีคิว</p>';
    } else {
        orders.forEach((order, i) => {
            const div = document.createElement('div');
            div.className = 'queue-item';

            // เช็คสถานะออเดอร์
            let statusText = '';
            let statusColor = '';
            if (order.status === "done") {
                statusText = "✔ เสร็จแล้ว";
                statusColor = "green";
            } else if (order.status === "cancel") {
                statusText = "❌ ยกเลิก";
                statusColor = "red";
            } else {
                statusText = "⌛ รอดำเนินการ";
                statusColor = "orange";
            }

            div.innerHTML = `
                <strong>#${i+1}</strong> ${order.time}<br>
                <span style="color:#333;">${order.items.map(it=> it.name + 'x' + it.quantity).join(', ')}</span><br>
                <em>รวม ${order.total} บาท</em><br>
                <span style="color:${statusColor}; font-weight:bold;">${statusText}</span>
            `;
            queueList.appendChild(div);
        });
    }
}

// เพิ่มฟังก์ชันพูด
function speak(text) {
    if ('speechSynthesis' in window) {
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = 'th-TH'; // ภาษาไทย
        window.speechSynthesis.speak(utter);
    }
}

// แก้ไข loadQueue() ตอนเช็คสถานะออเดอร์
function loadQueue() {
    const queueList = document.getElementById('queue-list');
    const orders = JSON.parse(localStorage.getItem('orders') || '[]');
    queueList.innerHTML = '';

    if (orders.length === 0) {
        queueList.innerHTML = '<p style="text-align:center; color:#666;">ยังไม่มีคิว</p>';
    } else {
        orders.forEach((order, i) => {
            const div = document.createElement('div');
            div.className = 'queue-item';

            // เช็คสถานะออเดอร์
            let statusText = '';
            let statusColor = '';
            if (order.status === "done") {
                statusText = "✔ เสร็จแล้ว";
                statusColor = "green";

                // ถ้ายังไม่ได้พูด ให้พูด
                if (!order.spoken) {
                    speak(`ออเดอร์ที่ ${i+1} เสร็จแล้วค่ะ`);
                    order.spoken = true; // บันทึกว่าได้พูดแล้ว
                    // อัปเดต localStorage ด้วย
                    const existingOrders = JSON.parse(localStorage.getItem('orders') || '[]');
                    existingOrders[i].spoken = true;
                    localStorage.setItem('orders', JSON.stringify(existingOrders));
                }

            } else if (order.status === "cancel") {
                statusText = "❌ ยกเลิก";
                statusColor = "red";
            } else {
                statusText = "⌛ รอดำเนินการ";
                statusColor = "orange";
            }

            div.innerHTML = `
                <strong>#${i+1}</strong> ${order.time}<br>
                <span style="color:#333;">${order.items.map(it=> it.name + 'x' + it.quantity).join(', ')}</span><br>
                <em>รวม ${order.total} บาท</em><br>
                <span style="color:${statusColor}; font-weight:bold;">${statusText}</span>
            `;
            queueList.appendChild(div);
        });
    }
}


</script>

</body>
</html>
